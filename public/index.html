<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SREF Gallery</title>
  <style>
    body { font-family:sans-serif; background:#f4f4f4; margin:0; padding:20px; }
    #gallery { display:flex; flex-wrap:wrap; gap:16px; }
    .item { background:white; padding:10px; border-radius:8px; width:200px; text-align:center; box-shadow:0 2px 4px rgba(0,0,0,0.1); }
    .item img { max-width:100%; height:auto; border-radius:4px; }
    .item button { margin-top:8px; padding:6px 12px; cursor:pointer; }
  </style>
</head>
<body>
  <h1>ComfyUI SREF Gallery</h1>
  <div id="gallery">Loading…</div>
  <script>
    // **CONFIG**: replace these with your own GitHub handle & repo name
        const username = 'NaomiVK';
        const repo     = 'comfyui-sref-gallery';
        const dir      = 'public/images';
        const apiUrl   = `https://api.github.com/repos/${username}/${repo}/contents/${dir}`;

    async function loadImages() {
      try {
        const res   = await fetch(apiUrl);
        const files = await res.json(); // list of { name, type, download_url, ... }
        const gallery = document.getElementById('gallery');
        gallery.innerHTML = '';
        files.forEach(f => {
          if (f.type==='file' && /\.(jpe?g|png|gif)$/i.test(f.name)) {
            const url = f.download_url;
            const div = document.createElement('div'); div.className='item';
            div.innerHTML = `
              <img src="${url}" alt="${f.name}">
              <button>Copy SREF</button>
            `;
            div.querySelector('button').onclick = () => navigator.clipboard.writeText(url);
            gallery.appendChild(div);
          }
        });
      } catch(e) {
        document.getElementById('gallery').textContent = 'Failed to load images…';
        console.error(e);
      }
    }
    loadImages();
  </script>

  <!-- Add this script to your Railway gallery HTML file to enable communication with ComfyUI -->
<script>
// Check if we're embedded in an iframe
if (window.parent !== window) {
    // Override the copy button click handler
    document.addEventListener('click', function(event) {
        // Check if the clicked element is a copy button
        if (event.target && event.target.textContent === 'Copy SREF') {
            // Get the image URL
            const galleryItem = event.target.closest('.gallery-item');
            const img = galleryItem ? galleryItem.querySelector('img') : null;
            const imageUrl = img ? img.src : '';
            
            if (imageUrl) {
                // Send message to parent window (ComfyUI)
                window.parent.postMessage({
                    type: 'sref-selected',
                    url: imageUrl
                }, '*');
                
                // Still perform the original copy action
                navigator.clipboard.writeText(imageUrl).then(() => {
                    console.log('SREF copied and sent to ComfyUI!');
                });
            }
        }
    });
}

// Alternative: If you want to add a special "Send to ComfyUI" button
function addComfyUIButtons() {
    const galleryItems = document.querySelectorAll('.gallery-item');
    
    galleryItems.forEach(item => {
        const img = item.querySelector('img');
        if (img && window.parent !== window) {
            const sendButton = document.createElement('button');
            sendButton.textContent = 'Send to ComfyUI';
            sendButton.className = 'copy-button'; // Use same styling as copy button
            sendButton.style.marginLeft = '5px';
            
            sendButton.addEventListener('click', () => {
                window.parent.postMessage({
                    type: 'sref-selected',
                    url: img.src
                }, '*');
                
                // Visual feedback
                sendButton.textContent = 'Sent!';
                setTimeout(() => {
                    sendButton.textContent = 'Send to ComfyUI';
                }, 1000);
            });
            
            const existingButton = item.querySelector('.copy-button');
            if (existingButton) {
                existingButton.parentNode.insertBefore(sendButton, existingButton.nextSibling);
            }
        }
    });
}

// Call when gallery is loaded
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', addComfyUIButtons);
} else {
    // DOM already loaded
    setTimeout(addComfyUIButtons, 100);
}
</script>
</body>
</html>
